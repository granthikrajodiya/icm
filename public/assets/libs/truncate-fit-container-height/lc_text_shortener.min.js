/* ------------------------------------------------------------------------
	* LC text shortener
	* micro jQuery plugin to create excerpts on the fly, basing on fixed or container's height
	*
	* @version: 	1.01
	* @requires:	jQuery v1.5 or later
	* @author:		Luca Montanari (LCweb)
	* @website:		http://www.lcweb.it
	
	* Licensed under the MIT license
------------------------------------------------------------------------- */

(function(a){a.fn.lc_txt_shortener=function(f,n,h){var c=a(this);"undefined"==typeof lcts_data&&(lcts_data={});"undefined"==typeof f&&(f="..");if("undefined"==typeof h)h=["br"];else{var k=["br"],r=["a","strong","em","p"],t=h.split(",");a.each(t,function(f,b){-1!==a.inArray(a.trim(b),r)&&k.push(a.trim(b))});h=k}var q=function(u){c.each(function(){var b=a(this),d=a(this).attr("lcts-id");if("undefined"!=typeof u&&"undefined"==typeof d)return!0;"undefined"==typeof d?(d=Math.round((new Date).getTime()+
100*Math.random()),a(this).attr("lcts-id",d),lcts_data[d]={orig_txt:b.html(),end_txt:f,allowed_tags:h}):(b.html(lcts_data[d].orig_txt),b.removeClass("lcnb_shorten"));b.find("*:empty").not("br, img, i").remove();var g=b.outerHeight(!0),c="undefined"!=typeof n&&n?parseInt(n):b.parent().height();if(c<g){b.html();b.addClass("lcnb_shorten");b.find("*").lcts_remove_all_attr();b.find("*").not(lcts_data[d].allowed_tags.join(",")).each(function(){var b=a(this).contents();a(this).replaceWith(b)});for(var p=
a.trim(b.html().replace(/(\r\n|\n|\r)/gm,"")).split(" "),l="",e="",m=g=0;g<c&&m<p.length;)"undefined"!=typeof p[m]&&(e=l,l=l+p[m]+" ",b.html(l+' <span class="lcts_end_txt">'+lcts_data[d].end_txt+"</span>"),g=b.outerHeight(!0),m++);if(null!=e.match("<br>","g"))for(;"<br>"==e.slice(-5);)e=a.trim(e.slice(0,-4));var k=lcts_data[d].allowed_tags;a.each(k,function(d,g){if("br"!=g){var c=e.match("<"+g,"g"),h=e.match("</"+g,"g");null!=c&&(null!=c&&null==h||c.length>h.length)&&(e=e+"</"+g+">")}d==k.length-
1&&(b.html(a.trim(e)+' <span class="lcts_end_txt">'+f+"</span>"),b.find("*:empty").not("br").remove())});b.find("p").last().css("display","inline")}})};a.fn.lcts_remove_all_attr=function(){return this.each(function(){var c=a.map(this.attributes,function(a){return a.name}),b=a(this);a.each(c,function(a,c){"href"!=c&&"target"!=c&&b.removeAttr(c)})})};a(window).resize(function(){"undefined"!=typeof lcts_debounce&&clearTimeout(lcts_debounce);lcts_debounce=setTimeout(function(){c.trigger("lcts_resize")},
75)});c.unbind("lcts_resize");c.bind("lcts_resize",function(){q(!0)});return q()};a.fn.lc_txt_unshorten=function(){return this.each(function(){var f=a(this).attr("lcts-id");if("undefined"==typeof f)return!0;a(this).html(lcts_data[f].orig_txt);a(this).unbind("lcts_resize");a(this).removeClass("lcnb_shorten").removeAttr("lcts-id");lcts_data[f]=!1})}})(jQuery);